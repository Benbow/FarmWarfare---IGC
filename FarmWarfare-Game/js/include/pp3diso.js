/**
 * pp3Diso
 * http://www.prelude-prod.fr
 *
 * @author Jean-François RENAULD
 * @version 2.2
 * Cette oeuvre est mise à disposition selon les termes de la Licence Creative Commons Paternité - Partage à l'Identique 3.0 non transcrit.
 * http://creativecommons.org/licenses/by-sa/3.0/deed.fr
 *
 * Si vous utilisez ce plugin, vous devez mettre un lien retour vers le site : http://www.prelude-prod.fr
 *
 * Date: Mon Jun 10 16:00:00 UTC 2013
 */
(function(a){a.fn.pp3Diso=function(a6){var a6=a.extend({CSSid:"",mapId:1,map:"",mapZones:"",mapZonesColors:"",zone:"",tx:0,ty:0,ty2:0,zoom:1,positionFixe:false,pathfinding:false,PF_corners:true,cursorPF:"",cursorZindex:0,PF_decx:0,PF_decy:0,PF_max:false,mousewheel:false,zoom_min:0.25,zoom_max:10,zoom_pas:0.5,fluide:true,nbrTitleSetsSlide:1,auto_resize:true,mode2d:false,mode2d_viewx:5,mode2d_viewy:5,mode2d_select:"#FBE6C1",mode2d_select_off:"#F47070",mode2d_fond:"#ffffff",titre_map:{},titre_case:"",mode2d_avatar:"Avatar",move_avatar_speed:50,bulle_auto_x:true,bulle_auto_y:"top",bulle_obj_deca_y:6,keys:true,keys_tab:{key_n:[38,104],key_ne:[105],key_e:[39,102],key_se:[99],key_s:[40,98],key_so:[97],key_o:[37,100],key_no:[103],key_zoom:[33],key_dezoom:[34],key_clic:[32,101]},prefix:"map-",path:"images/",fogofwar:0,speed_avatar:250,speed_map:100,speed_map_while:100,speed_by_titleset:1,drag:true,cursorDelay:false,oncursordelay:function(bs,bu,bt){},onmoveavatar:function(bs,bu,bt){},beforemoveavatar:function(bs,bt){return true},beforeclosewin:function(bt,bs){return true},afterclosewin:function(bt,bs){},onenterbuilding:function(bs,bu,bt){},onleavebuilding:function(bs,bu,bt){},onenterobject:function(bs,bu,bt){},onleaveobject:function(bs,bu,bt){},onclicbuilding:function(bs,bu,bt){},onclicobject:function(bs,bu,bt){},onchangezoom:function(bs){}},a6);var j=a(this);var d=this;var ak=("ontouchstart" in window);if(a6.positionFixe==true){a6.drag=false}a6.ty2=(a6.tx>>2);var n=1;var e=0;var c=0;var am=0;var W=0;if(a6.mode2d){mousewheel=false}var v;var R=a6.tx;var Q=a6.ty;var av=a6.ty2;var aj="";var aF=0;var aC=0;var bp=1;var bn=1;var q,bf,aE;var a2,a1;var ag=0;var af=0;var aw=null;var A=[];var aU=[];var Z=false;var O,N;var m="";var aB="";var bb=0;var ba=0;var U=0;var S=0;var an=false;var ah;var bl=false;var aq=false;var w;var a5=[];var bk=a6.PF_max;var aa;var aT;var bh=false;var M,bm,J,K,ac,I,E;var G,D,aK,al,aM,aL,C;var bi=[];var ap,bo,ar;var ae,ad,H;var az,ax;var ao=false;var r,p;var a0=false;var a3=0;move_map_waiting=false;aN();var z;var br=null;var L="";var au=1;function aN(){v=~~(a6.zoom*100)+"%";a6.tx=R*a6.zoom;a6.ty=Q*a6.zoom;a6.ty2=av*a6.zoom;bh=false;ae=j.width();ad=j.height();if(a6.zone=="undefined"){a6.zone=""}var bz=j.children(".pp3diso_users").detach();j.children().remove().empty();j.append(bz);a(".pp3diso_users").css({"z-index":760000});if(!a6.mode2d){j.append('<div id="pp3Diso-wait"></div>');aa=a("#pp3Diso-wait")}bm=a6.map.split(":");if(a6.zone!=""){var by=a6.zone.split(":")}M=a6.path+a6.prefix;dummy=bm[0].split(",");J=bm.length;K=dummy.length;w=new Array(K);for(bs=0;bs<J;bs++){w[bs]=new Array(J)}aK=(a6.tx>>1);al=a6.ty2;aM=K*(a6.tx);aL=J*(al<<1)+(a6.ty2);C=aM>>1;if(a6.mapZones!=""){var bu=a6.mapZones.split(":")}ac=new Array(J);I=new Array(J);E=new Array(J);z=new Array(J);ap=new Array(J);G=0;D=0;ai();for(var bx=1;bx<=J;bx++){E[bx]=new Array(K);ac[bx]=new Array(K);ap[bx]=new Array(K);I[bx]=new Array(K);z[bx]=new Array(K);var bw=bm[bx-1].split(",");if(a6.zone!=""){var bv=by[bx-1].split(",")}if(a6.mapZones!=""){var bt=bu[bx-1].split(",")}for(var bs=1;bs<=K;bs++){E[bx][bs]=~~(bw[bs-1]);if(a6.fogofwar>0){I[bx][bs]=0}else{I[bx][bs]=1}f(bs,bx);if(a6.zone!=""){ac[bx][bs]=~~(bv[bs-1])}else{if(E[bx][bs]>0){ac[bx][bs]=1}else{ac[bx][bs]=0}}if(a6.mapZones!=""){ap[bx][bs]=(bt[bs-1]|0)}else{ap[bx][bs]=0}}}if(a6.auto_size){j.css({width:aM,height:aL})}e=((ae-aM)>>1);c=((ad-aL)>>1);am=e;W=c;aR(E);bc((K|0),(J|0));aW(E);a("#ppISO").bind("mouseenter",function(){a("#ppISO").focus()});a("#ppISO").focus()}function aR(bN){O=0;N=0;var bF="";var bI=[0,al,aK,0,a6.tx,al,aK,al<<1];var bJ=(a6.zoom<<3);var bH=(bJ>>1);var bx=[-bJ,al,aK,-bH,a6.tx+bJ,al,aK,(al<<1)+bH];if(a("#pp3Diso-conteneur").length==0){j.append('<div id="pp3Diso-conteneur"></div>')}a(".pp3diso").unbind("keyup");H=a("#pp3Diso-conteneur");if(!a6.mode2d){H.css({display:"block",position:"absolute",top:9999,left:9999,width:aM,height:aL})}if(a6.mousewheel){ab()}var bD=a6.mapZonesColors.split(":");if(!a6.mode2d&&a6.mapZones!=""&&a("#pp3Diso-mapZone").length==0){H.append('<div id="pp3Diso-mapZone"></div>');var bv=bD.length;bo=new Array(bv);ar=new Array(bv);var bO=new Array(bv);for(var bK=0;bK<bv;bK++){bO[bK]=document.createElement("canvas");bO[bK].id="pp3Diso-mapZone-canvas-"+bK;a("#pp3Diso-mapZone").append(bO[bK]);bo[bK]=a("#pp3Diso-mapZone-canvas-"+bK)[0];ar[bK]=bo[bK].getContext("2d");bo[bK].width=aM;bo[bK].height=aL;a("#pp3Diso-mapZone-canvas-"+bK).css({display:"none",position:"absolute",top:0,left:0,"z-index":299000,"-moz-opacity":0.5,opacity:0.5,filter:"alpha(opacity=50)"})}a("#pp3Diso-mapZone").css({display:"block",position:"absolute",top:0,left:0,width:aM,height:aL,"z-index":299000})}if(!a6.mode2d){aa.css("display","block")}if(a("#pp3Diso-bulle").length==0){H.append('<div id="pp3Diso-bulle"></div>')}aT=a("#pp3Diso-bulle");aT.css("display","none");var bM="pp3diso-Map-"+n;n++;var by='<map name="'+bM+'" id="'+bM+'">';for(var bC=1;bC<=J;bC++){for(var bE=1;bE<=K;bE++){bF="c_"+bC+"_"+bE;var bA=bj(bC,bE);var bB=u(bC,bE);z[bC][bE]=new Array(2);z[bC][bE][0]=(bB|0);z[bC][bE][1]=(bA|0);if(a6.mapZones!=""&&!a6.mode2d){if(ap[bC][bE]>0){var bG=ap[bC][bE]-1;ar[bG].fillStyle=bD[bG];ar[bG].beginPath();ar[bG].moveTo(~~(bx[0]+bB),~~(bx[1]+bA));var bw=bI.length-1;for(var bL=2;bL<bw;bL+=2){ar[bG].lineTo(~~(bx[bL]+bB),~~(bx[bL+1]+bA))}ar[bG].closePath();ar[bG].fill()}}if(a6.mode2d){}else{var bz="";var bw=bI.length;for(var bK=0;bK<bw;bK+=2){var bu=~~((bI[bK])+bB);var bt=~~((bI[bK+1])+bA);bz+=","+bu+","+bt}bz=bz.substring(1);var bs="s_"+bC+"_"+bE;bz='<area id="'+bs+'" class="pp3diso-shap" shape="poly" coords="'+bz+'" alt="" />';by+=bz}}}if(!a6.mode2d){by+="</map>";H.prepend('<div id="pp3diso-clicks"><img src="images/vide.gif" id="pp3diso-mapControl" width="'+aM+'" height="'+aL+'" alt="" />'+by+"</div>");a("#pp3diso-mapControl").attr("usemap","#"+bM);a("#pp3diso-clicks").css({"z-index":750000,position:"absolute",left:0,top:0,display:"block"})}if(a6.keys){a(window).keyup(function(bV){var bQ=U;var bW=S;var bT=false;var bP=null;for(var bU in a6.keys_tab){for(var bS in a6.keys_tab[bU]){if(a6.keys_tab[bU][bS]==bV.keyCode){bP=bU;bT=true;break}}}switch(bP){case"key_n":bW--;break;case"key_ne":bW--;bQ++;break;case"key_e":bQ++;break;case"key_se":bW++;bQ++;break;case"key_s":bW++;break;case"key_so":bW++;bQ--;break;case"key_o":bQ--;break;case"key_no":bW--;bQ--;break;case"key_clic":if(aZ(bQ,bW)){B(bQ,bW,true)}break;case"key_zoom":b(a6.zoom+a6.zoom_pas);break;case"key_dezoom":b(a6.zoom-a6.zoom_pas);break}if(bT){if(!a6.mode2d){var bR=a("#s_"+bW+"_"+bQ);if(bR.length){a8(bR)}}else{var bR=a("#c_"+bW+"_"+bQ);if(bR.length){a8(bR)}}}if(bT===true){bV.stopPropagation();bV.preventDefault();return}else{return false}})}if(!a6.mode2d){a(".pp3diso-shap").bind("click",(function(){if(window.Touch){a8(a(this))}if(!a0){aP(a(this))}}));if(a6.cursorDelay!==false){a(".pp3diso-shap").bind("mouseenter",function(){L=a(this).attr("id");if(au==1){br=window.setTimeout(function(){window.clearTimeout(br);var bP=L.split("_");a6.oncursordelay(bP[2],bP[1],a6.mapId)},a6.cursorDelay)}});a(".pp3diso-shap").bind("mouseout",function(){window.clearTimeout(br)})}if(!ak){a(".pp3diso-shap").bind("mouseenter",function(){a8(a(this))})}}if(a6.drag&&!a6.mode2d){a("#pp3Diso-conteneur").bind("touchstart",function(bQ){a0=false;var bR=bQ.originalEvent;var bP=H.position();r=bR.changedTouches[0].clientX-bP.left;p=bR.changedTouches[0].clientY-bP.top;a("#pp3Diso-conteneur").bind("click",function(){return false});a("#pp3Diso-conteneur").bind("touchmove",function(bS){a9(bS)});a("#pp3Diso-conteneur").bind("touchend touchcancel",function(bS){bq(bS,a(this))});if(!aq){aq=true;setTimeout(function(){aq=false},100)}});a(".pp3diso-shap").bind("mousedown",function(bR){a0=false;var bP=bR||window.event;var bQ=H.position();r=bP.clientX-bQ.left;p=bP.clientY-bQ.top;a("#pp3Diso-conteneur").bind("click",function(){return false});a("#pp3Diso-conteneur").bind("mousemove",aD).bind("mouseup",bq);return false})}j.focus()}function aD(bv){bv.preventDefault();a0=true;var bu=bv||window.event;var bt=bu.clientX-r;var bs=bu.clientY-p;if(bs>(a6.ty<<1)){bs=a6.ty<<1}if(bt>(a6.tx)){bt=a6.tx}if(bt<-((aM-ae)+a6.tx)){bt=-((aM-ae)+a6.tx)}if(bs<-((aL-ad)+a6.ty)){bs=-((aL-ad)+a6.ty)}H.css({left:bt,top:bs});return false}function bq(by,bw){var bx=H.position();var bt=~~(-bx.left/a6.tx);var bs=~~(-bx.top/a6.ty);var bv=e;var bu=c;e=bx.left;c=bx.top;a("#pp3Diso-conteneur").unbind("mousemove",aD).unbind("mouseup",bq);if(bv!=e&&bu!=c){aW(E)}a(".pp3diso-shap").unbind("touchmove");a(".pp3diso-shap").unbind("ontouchend");if(aq){aq=false;aP(bw)}return false}function a9(bu){bu.preventDefault();a0=true;var bv=bu.originalEvent;var bt=bv.changedTouches[0].clientX-r;var bs=bv.changedTouches[0].clientY-p;if(bs>(a6.ty<<1)){bs=a6.ty<<1}if(bt>(a6.tx)){bt=a6.tx}if(bt<-((aM-ae)+a6.tx)){bt=-((aM-ae)+a6.tx)}if(bs<-((aL-ad)+a6.ty)){bs=-((aL-ad)+a6.ty)}H.css({left:bt,top:bs});return false}function ab(){var bt=["DOMMouseScroll","mousewheel"];if(this.addEventListener){for(var bs=bt.length;bs;){j[0].addEventListener(bt[--bs],bd,false)}}else{j[0].onmousewheel=bd}}var aX=0;function bd(bx){var bz=new Date();bx.preventDefault();bx.stopPropagation();var bv=bx||window.event,bu=[].slice.call(arguments,1),by=0,bw=true,bt=0,bs=0;bx=a.event.fix(bv);bx.type="mousewheel";if(bv.wheelDelta){by=bv.wheelDelta/120}if(bv.detail){by=-bv.detail/3}bs=by;if(bv.axis!==undefined&&bv.axis===bv.HORIZONTAL_AXIS){bs=0;bt=-1*by}if(bv.wheelDeltaY!==undefined){bs=bv.wheelDeltaY/120}if(bv.wheelDeltaX!==undefined){bt=-1*bv.wheelDeltaX/120}bu.unshift(bx,by,bt,bs);if((bz.valueOf()-aX)>1000){if(bu[1]<0){b(a6.zoom-a6.zoom_pas)}else{b(a6.zoom+a6.zoom_pas)}aX=bz.valueOf()}return false}function t(){if(!a6.mode2d){for(var bv=1;bv<=J;bv++){for(var bs=1;bs<=K;bs++){id="c_"+bv+"_"+bs;var bt=g(bv,bs)+c;var bu=h(bv,bs)+e;if(bu>-tx&&bu<(ae+tx)&&bt>-ty&&bt<(ad+ty)){H.append('<div id="'+id+'" class="pp3diso-sol"></div>');a("#"+id).css({"z-index":aS(bv,bs),position:"absolute",left:(bu|0),top:(bt|0),width:a6.tx,height:a6.ty,display:"block"})}}}}}function P(){if(a6.mode2d){aW(E)}if(a3==0&&!a6.mode2d){if(move_map_waiting){H.css("display","none")}move_map_waiting=false;bl=true;if(a6.positionFixe==true){H.animate({left:(am|0),top:(W|0)},a6.speed_map,function(){aW(E);bl=false;H.fadeIn("100");aa.css("display","none")})}else{if(a6.fluide){H.animate({left:(e|0),top:(c|0)},a6.speed_map,function(){aW(E);bl=false;H.fadeIn("100");aa.css("display","none")})}else{H.css({left:(e|0),top:(c|0)});aW(E);bl=false;aa.css("display","none")}}}else{move_map_waiting=true}}function be(bs,bt){if(!a6.mode2d){bs=(bs|0);bt=(bt|0);id="c_"+bt+"_"+bs;a("#"+id).fadeTo(0,I[bt][bs]);id="b_"+bt+"_"+bs;a("#"+id).fadeTo(0,1);id="o_"+bt+"_"+bs;a("#"+id).fadeTo(0,1)}}function aA(bA,bz,bu){bA=(bA|0);bz=(bz|0);bu=(bu|0);if(bz<1||bA<1||bz>J||bA>K){return}if(I[bz][bA]<bu){I[bz][bA]=bu}if(I[bz][bA]>1){I[bz][bA]=1}be(bA,bz);var bt=a6.fogofwar;for(var bs=bA-bt;bs<=bA+bt;bs++){var bw=Math.abs(bs-bA);for(var by=bz-bt;by<=bz+bt;by++){var bx=Math.abs(by-bz);if(bw>bx){bx=bw}if(bs!=bA||by!=bz){if(!(by<1||bs<1||by>J||bs>K)){var bv=(bu/bx);if(I[by][bs]<bv){I[by][bs]=bv}if(I[by][bs]>1){I[by][bs]=1}be(bs,by)}}}}}function aW(bN){var bE="";var bs="";var bL=a6.tx*3;var bx=a6.ty*3;if(U<1){U=1}if(S<1){S=1}if(a6.mode2d){var bC=(U|0)-(a6.mode2d_viewx|0);var bz=(U|0)+(a6.mode2d_viewx|0);if(bC<1){bz=bz-(bC-1)}if(bz>K){bC=K-(((a6.mode2d_viewx|0)<<1))}var bA=(S|0)-(a6.mode2d_viewy|0);var by=(S|0)+(a6.mode2d_viewy|0);if(bA<1){by=by-(bA-1)}if(by>J){bA=J-(((a6.mode2d_viewy|0)<<1))}if(bC<1){bC=1}if(bz>K){bz=K}if(bA<1){bA=1}if(by>K){by=J}}var bw=ae+bL;var bu=ad+bx;for(var bH=1;bH<=J;bH++){if(a6.mode2d){if(bH>=bA&&bH<=by){bs=bs+'<tr><th id="y'+bH+'" axis="axe des ordonn�es">'+bH+"</th>"}}var bt="c_"+bH;for(var bI=1;bI<=K;bI++){var bG=z[bH][bI][0];var bF=z[bH][bI][1];var bD=bG+e;var bK=bF+c;var bJ=bt+"_"+bI;var bv=a("#"+bJ);if(a6.mode2d){if(bI>=bC&&bI<=bz&&bH>=bA&&bH<=by){bs=bs+'<td headers="x'+bI+" y"+bH+'" id="'+bJ+'"></td>'}}else{if(bD>-bL&&bD<(bw)&&bK>-bx&&bK<(bu)){if(bv.length==0){bs=bs+'<div id="'+bJ+'" class="pp3diso-sol"></div>'}else{if(a6.fogofwar>0){be(bI,bH)}if(bv[0].getAttribute("display")!="block"){bv.css("display","block")}}}else{bv.remove().empty()}}}if(a6.mode2d){if(bH>=bA&&bH<=by){bs=bs+"</tr>"}}}if(a6.mode2d){totalFrag_dummy='<table id="pp3diso_table">';totalFrag_dummy=totalFrag_dummy+"<tr><td>&nbsp;</td>";for(bI=bC;bI<=bz;bI++){totalFrag_dummy=totalFrag_dummy+'<th id="x'+bI+'" axis="axe des abscisses">'+bI+"</th>"}totalFrag_dummy=totalFrag_dummy+"</tr>";bs=totalFrag_dummy+bs+"</table>";a("#pp3diso_table").remove()}H.append(bs);var bB="100%";for(var bH=1;bH<=J;bH++){for(var bI=1;bI<=K;bI++){var bG=h(bH,bI);var bF=g(bH,bI);var bD=bG+e;var bK=bF+c;var bJ="c_"+bH+"_"+bI;var bv=a("#"+bJ);if(a6.mode2d){var bM=aI(bI,bH,bN);bv.html(bM).click(function(){var bO=a(this).attr("id");var bQ=bO.split("_");var bR=bQ[2];var bP=bQ[1];if(aZ(bR,bP)){B(bR,bP,true)}a8(a(this))}).mouseover(function(){a8(a(this))})}else{if(bD>-bL&&bD<(ae+bL)&&bK>-bx&&bK<(ad+bx)){if(!bv.length==0){bE=bN[bH][bI]+".png";if(bE!="NaN.png"){bE=M+bE;bv.css({"z-index":aS(bH,bI),position:"absolute",left:(bG|0),top:(bF|0),width:a6.tx,height:a6.ty,"background-image":"url('"+bE+"')",display:"block","-webkit-background-size":bB+" "+bB,"-o-background-size":bB+" "+bB,"-moz-background-size":bB+" "+bB,"background-size":bB+" "+bB})}}}}}}}function aI(bs,bx,bw){var bv="<p>";var bu="";var bt=" ";if(a6.titre_case!=""){bu=a6.titre_case;bu=aJ(bu,"[x]",bs);bu=aJ(bu,"[y]",bx)}bv=""+bu+bt;bv=bv+""+a6.titre_map[bw[bx][bs]]+bt;bu=aG(bs,bx);if(bu!=""){bv=bv+""+bu+bt}if(bp==bs&&bn==bx){bv=bv+""+a6.mode2d_avatar+bt}bv=bv+"</p>";return bv}function aJ(bu,bt,bs){SRRi=bu.indexOf(bt);SRRr="";if(SRRi==-1){return bu}SRRr+=bu.substring(0,SRRi)+bs;if(SRRi+bt.length<bu.length){SRRr+=aJ(bu.substring(SRRi+bt.length,bu.length),bt,bs)}return SRRr}function aS(bt,bs){return(bs<<1)+(bt<<1)}function u(bu,bs){bs=bs|0;bu=bu|0;var bt=C+((bs-1)*aK);bt=bt-(aK*(bu+1))+aK;return(bt|0)}function bj(bu,bs){bs=bs|0;bu=bu|0;var bt=(bu-1)*(al);bt=bt+(al*(bs-1));return(bt|0)}function h(bt,bs){return z[bt|0][bs|0][0]}function g(bt,bs){return z[bt|0][bs|0][1]}function V(bs){return(bs|0)}function aH(bs,bu){for(var bt in bi){if(bi[bt]["x"]==bs&&bi[bt]["y"]==bu){return true}}return false}function aG(bs,bw,bu){if(typeof(bu)=="undefined"){bu=" / "}var bv="";for(var bt in bi){if(bi[bt]["x"]==bs&&bi[bt]["y"]==bw){bv=bv+bu+bi[bt]["titre"]}}bv=bv.substr(bu.length);return bv}function a8(bu){var bv=bu.attr("id");if(typeof(bv)=="undefined"){return}var bx=bv.split("_");var bt=bx[2];var bz=bx[1];if(U!=bt||S!=bz){if(ac[S][U]==2){a6.onleavebuilding(U,S,a6.mapId)}else{if(aH(U,S)){a6.onleaveobject(U,S,a6.mapId)}}}U=bt;S=bz;var bs=h(bz,bt)+(bb*a6.zoom);var by=g(bz,bt)+(ba*a6.zoom);if(aZ(bt,bz)){a("#pp3diso-cursor-img").attr("src",m);color_m2d=a6.mode2d_select}else{a("#pp3diso-cursor-img").attr("src",aB);color_m2d=a6.mode2d_select_off}if(!a6.mode2d){if(a6.cursorZindex>0){var bw=300000+aS(bz|0,bt|0)+(a6.cursorZindex|0);a("#pp3diso-cursor").css({display:"block",left:bs,top:by,"z-index":bw})}else{a("#pp3diso-cursor").css({display:"block",left:bs,top:by})}}else{a("#pp3diso_table td").css("background-color",a6.mode2d_fond);bu.css("background-color",color_m2d);bu.first("p").focus()}if(ac[bz][bt]==2){a6.onenterbuilding(bt,bz,a6.mapId)}else{if(aH(bt,bz)){a6.onenterobject(bt,bz,a6.mapId)}}}var aV=false;function ay(){if(!aV){a5=null;a5=[];for(y=0;y<J;y++){for(x=0;x<J;x++){if(ac[y+1][x+1]==1){w[x][y]=1}else{w[x][y]=0}}}}}function a4(bC,bA){var bx=bp;var bu=bn;var by=bC;var bv=bA;var bB,bw,bz,bt;ay();if(bk!=false){bB=bx-(bk+1);bw=bx+bk;bz=bu-(bk+1);bt=bu+bk;if(bB<0){bB=0}if(bw>=K){bw=K}if(bz<0){bz=0}if(bt>=J){bt=J}}else{bB=false;bw=false;bz=false;bt=false}var bs=astar(bx-1,bu-1,by-1,bv-1,w,a6.PF_corners,bz,bt,bB,bw);if(bs!=null){aQ(bs);return true}else{return false}}function a7(bH,bG,bA){var bJ=bp;var bI=bn;var bF=bH;var bE=bG;var bB,bz,by,bx;var bw,bv,bu,bt;ay();if(bk!=false){bw=bJ-(bk+1);bv=bJ+bk;bu=bI-(bk+1);bt=bI+bk;if(bw<0){bw=0}if(bv>=K){bv=K}if(bu<0){bu=0}if(bt>=J){bt=J}}else{bw=false;bv=false;bu=false;bt=false}var bK=astar(bJ-1,bI-1,bF-1,bE-1,w,a6.PF_corners,bu,bt,bw,bv);if(bK!=null){var bD=bK.length;for(var bN=0;bN<bD;bN++){var bM=h(bK[bN].col+1,bK[bN].row+1);var bL=g(bK[bN].col+1,bK[bN].row+1);var bP=a6.tx>>1;var bC=a6.ty>>1;if(!a6.beforemoveavatar(bH,bG)){return}if(bN<1){bB=bp;bz=bn}else{bB=bK[bN-1].row+1;bz=bK[bN-1].col+1}by=bK[bN].row+1;bx=bK[bN].col+1;var bs=1;if(by>bB){bs=3}else{if(by<bB){bs=2}else{if(bx>bz){bs=1}else{if(bx<bz){bs=4}else{bs=1}}}}if(bN<1){af=bs}else{A.push(bs)}bp=bH;bn=bG;a5.push(bK[bN].col+1+","+bK[bN].row+1);var bO=a("#pp3diso-avatar");aU.push(300000+aS(bK[bN].col+1,bK[bN].row+1));bO.animate({left:bM+aF,top:bL+aC},{step:function(){aw++;if(aw>a6.move_avatar_speed){Y();aw=0}},duration:a6.speed_avatar,complete:function(){if(A.length){af=A.shift()}var bR=a5.pop();var bQ=aU.shift();if(aU.length<=1){}bO.css("z-index",bQ)}});if(a6.fogofwar>0){aA(bH,bG,1)}}}if(bA){a6.onmoveavatar(bH,bG,a6.mapId)}}function Y(){if(Z){var bs=~~((a2*(ag))*a6.zoom);var bt=~~((a1*(af-1))*a6.zoom);a("#pp3diso-avatar-img").css({left:-bs,top:-bt});ag++;if(ag>=aE){ag=0}}}function aQ(bx){a(".pp3Diso_PF").remove().empty();var bw=bx.length;for(var bv=0;bv<bw;bv++){var bs=h(bx[bv].col+1,bx[bv].row+1);var bz=g(bx[bv].col+1,bx[bv].row+1);var by="pp3Diso_PF_"+bs+"-"+bz;var bu='<div id="'+by+'" class="pp3Diso_PF"></div>';H.append(bu);var bt="100%";a("#"+by).css({position:"absolute",display:"block",width:a6.tx,height:a6.ty,"background-image":"url('"+a6.cursorPF+"')","-webkit-background-size":bt+" "+bt,"-o-background-size":bt+" "+bt,"-moz-background-size":bt+" "+bt,"background-size":bt+" "+bt,left:bs+a6.PF_decx,top:bz+a6.PF_decy,"z-index":300000+bx[bv].col+1+bx[bv].row+1})}}function aZ(bs,bu){if(a6.pathfinding){return a4(bs,bu)}else{var bt=false;if(aj==""){bt=true}else{bs=(bs|0);bu=(bu|0);if(bs>=bp-1&&bs<=bp+1&&bu>=bn-1&&bu<=bn+1){bt=true}else{bt=false}}if(ac[bu][bs]==1&&bt){return true}else{return false}}}function B(bA,bz,bC){bA=(bA|0);bz=(bz|0);var by=h(bz,bA);var bx=g(bz,bA);var bv=a6.tx>>1;var bD=a6.ty>>1;if(a6.pathfinding){a7(bA,bz,bC)}else{if(!a6.beforemoveavatar(bA,bz)){return}if(!a6.mode2d){var bw=a("#pp3diso-avatar");bw.animate({left:by+aF,top:bx+aC},a6.speed_avatar);bw.css({"z-index":300000+aS(bz,bA)})}bp=bA;bn=bz;if(a6.fogofwar>0){aA(bA,bz,1)}if(bC){a6.onmoveavatar(bA,bz,a6.mapId)}}modif_move=false;if(ae<aM+(a6.tx>>1)){var bu=a6.nbrTitleSetsSlide*a6.tx;var bs=~~(by+e+bv);var bt=((ae>>1)+bu);if(bs>bt){while(bs>bt){e-=bu;bs=~~(by+e+bv)}modif_move=true}bt=((ae>>1)-bu);if(bs<bt){while(bs<bt){e+=bu;bs=~~(by+e+bv)}modif_move=true}}if(ad<aL+(a6.ty>>1)){var bu=a6.nbrTitleSetsSlide*a6.ty;var bs=~~(bx+c+bD);var bt=((ad>>1)+bu);if(bs>bt){while(bs>bt){c-=bu;bs=~~(bx+c+bD)}modif_move=true}bt=((ad>>1)-bu);if(bs<bt){while(bs<bt){c+=bu;bs=~~(bx+c+bD)}modif_move=true}}U=bp;S=bn;if(!a6.mode2d){var bB=a("#s_"+S+"_"+U);if(bB.length){a8(bB)}}else{var bB=a("#c_"+S+"_"+U);a8(bB);modif_move=true}if(modif_move){P()}}function aP(bt){var bu=bt.attr("id");var bv=bu.split("_");var bs=bv[2];var bw=bv[1];aT.css("display","none");if(ac[bw][bs]==2){a6.onclicbuilding(bs,bw,a6.mapId)}else{if(aH(bs,bw)){a6.onclicobject(bs,bw,a6.mapId)}}if(aZ(bs,bw)){B(bs,bw,true)}}function F(bs){bs=bs.substring(0,bs.length-2);return(bs|0)}function ai(){a("#pp3diso-avatar").remove().empty()}this.reload=function(bu,bs,bv,bt){bi=null;bi=[];aO();bp=1;bn=1;U=1;S=1;a6.map=bu;a6.zone=bs;a6.mapZones=bv;a6.mapId=bt;aN();P()};this.show=function(bs){if(!a6.fogofwar>0){}B(bp,bn,bs);H.css("display","none")};this.changeCursor=function(bt,bu,bs,bv){a("#pp3diso-cursor").remove().empty();O=0;l(bt,bu,bs,bv)};this.cursor=function(bt,bu,bs,bv){l(bt,bu,bs,bv)};function l(bt,bu,bs,bv){m=bt;aB=bu;bb=bs;ba=bv;if(!a6.mode2d){H.append('<div id="pp3diso-cursor"><img id="pp3diso-cursor-img" src="'+bt+'" alt="" /></div>');a("#pp3diso-cursor-img").load(function(){if(this.width<1){}else{if(O<1){a("#pp3diso-cursor-img").attr("rel",this.width+":"+this.height);O=~~(this.width*a6.zoom);N=~~(this.height*a6.zoom);this.width=O;this.height=N}}});a("#pp3diso-cursor").css({"z-index":299000,position:"absolute",left:0,top:0,display:"block"})}}function bc(bs,bv){var bu=h(bv,bs);var bt=g(bv,bs);e=-((bu-(ae>>1))|0);c=-((bt-(ad>>1))|0);U=bs;S=bv;bp=bs;bn=bv;if(bl){setTimeout(function(){bc(bs,bv)},250)}else{P();H.css("display","block")}}this.moveTo=function(bs,bt){bc(bs,bt)};this.getMonde=function(){var bs=new Array(K+1);for(x=1;x<=K;x++){bs[x]=new Array(J+1);for(y=1;y<=J;y++){bs[x][y]=E[y][x]}}return bs};this.getObjects=function(){return bi};this.getBuilding=function(){var bs=new Array(K+1);for(x=1;x<=K;x++){bs[x]=new Array(J+1);for(y=1;y<=J;y++){bt="";var bu="b_"+y+"_"+x;if(a("#"+bu+" img").length>0){var bt=a("#"+bu+" img").attr("src")}bs[x][y]=bt}}return bs};this.moveObject=function(bs,bA,by,bt,bw){for(var bv in bi){if(bi[bv]["id"]==bs){bi[bv]["x"]=bA;bi[bv]["y"]=by;var bB=h(by,bA)+(bi[bv]["decx"]*a6.zoom);var bz=g(by,bA)+(bi[bv]["decy"]*a6.zoom);var bu="o_"+bs;if(bt){var bx=300000+aS(by,bA);a("#"+bu).css("z-index",bx).animate({left:(bB|0),top:(bz|0)},bw)}else{a("#"+bu).css({"z-index":300000+aS(by,bA),left:(bB|0),top:(bz|0)})}break}}};this.killAvatar=function(){ai()};this.avatar=function(bt,by,bv,bs,bx,bu,bw){at(bt,by,bv,bs,bx,bu,bw)};function at(bA,bz,bs,bu,bt,bv,by){if(bl){setTimeout(function(){at(bA,bz,bs,bu,bt,bv,by)},250);return}ai();if(typeof(bv)=="undefined"){bv=false;by=1;var bw=1}else{var bw=4}var bx=~~(100*by)+"%";aF=bu*a6.zoom;aC=bt*a6.zoom;q=bu;bf=bt;bp=bA;bn=bz;aE=by;Z=bv;aj=bs;if(!a6.mode2d){H.append('<div id="pp3diso-avatar"><img id="pp3diso-avatar-img" src="'+bs+'" alt="" /></div>');a("#pp3diso-avatar-img").load(function(){var bC=this.width;var bB=this.height;a2=~~(bC/by);a1=~~(bB/bw);var bE=~~(a2*a6.zoom);var bD=~~(a1*a6.zoom);var bF=a("#pp3diso-avatar-img");a("#pp3diso-avatar").css({"z-index":300000+aS(bz,bA),position:"absolute",left:h(bz,bA)+bu,top:g(bz,bA)+bt,width:bE,height:bD,overflow:"hidden",display:"block"});bF.css({position:"absolute",display:"block",left:0,top:0,width:bE*by,height:bD*bw});B(bp,bn,false)})}else{B(bp,bn,false)}}this.moveAvatarTo=function(bs,bt){bp=bs;bn=bt;B(bs,bt,false)};this.changeOneMap=function(bs,by,bv){var bx="c_"+by+"_"+bs;var bu=a("#"+bx);var bt="100%";var bw=M+bv+".png";E[by][bs]=bv;bu.css({"background-image":"url('"+bw+"')","-webkit-background-size":bt+" "+bt,"-o-background-size":bt+" "+bt,"-moz-background-size":bt+" "+bt,"background-size":bt+" "+bt})};this.changeState=function(bs,bu,bt){ac[bu][bs]=bt};this.getState=function(bs,bt){return ac[bt][bs]};this.getOneMap=function(bs,bt){return E[bt][bs]};this.killBuilding=function(bs,bt){f(bs,bt)};function f(bs,bu){var bt="#b_"+bu+"_"+bs;ac[bu][bs]=1;if(a(bt).length){a(bt).remove().empty()}}this.addBuilding=function(bt,bw,bu,bs,bv){aY(bt,bw,bu,bs,bv)};function aY(bz,bx,bB,bu,bt){var bw=v;var bA=h(bx,bz)+(bu*a6.zoom);var by=g(bx,bz)+(bt*a6.zoom);ac[bx][bz]=2;var bs="b_"+bx+"_"+bz;H.append('<div id="'+bs+'" class="pp3diso-batiment"><img src="'+bB+'" alt="" /></div>');var bv=a("#"+bs);bv.attr("rel",bB+":"+bu+":"+bt);a3++;a("#"+bs+" img").load(function(){var bD=~~(this.width*a6.zoom);var bC=~~(this.height*a6.zoom);a(this).attr("rel",this.width+":"+this.height+":"+this.top+":"+this.left);a(this).width(bD).height(bC);a3--;if(move_map_waiting){P()}});bv.css({"z-index":300000+aS(bx,bz),position:"absolute",left:(bA|0),top:(by|0),display:"block"})}function s(){var bt=[];for(var bs in bi){if(bi[bs]["id"]!=""){bt[bs]=[];bt[bs]=bi[bs]}}bi=null;bi=bt}this.killObject=function(bs){T(bs)};function T(bu){var bt="#o_"+bu;for(var bs in bi){if(bi[bs]["id"]==bu){bi[bs]["id"]="";break}}s();if(a(bt).length){a(bt).remove().empty()}}this.addObject=function(bt,bz,bu,bs,by,bx,bv,bw){return X(bt,bz,bu,bs,by,bx,bv,bw)};function X(bC,bA,bE,bv,bt,bz,bx,bs){var bD=h(bA,bC)+(bv*a6.zoom);var bB=g(bA,bC)+(bt*a6.zoom);if(typeof(bx)=="undefined"){bx=""}dummy=bi.length+1;if(typeof(bs)=="undefined"){bs=dummy}var bw=[];bw.id=bs;bw.x=bC;bw.y=bA;bw.sprite=bE;bw.decx=bv;bw.decy=bt;bw.titre=bz;bw.bulle=bx;bi.push(bw);if(a6.mode2d){var bs="c_"+bA+"_"+bC;var bF=a("#"+bs);if(bz!=""){bF.append("<p>"+bz+" ("+bx+")</p>")}}else{var bu="o_"+bs;a("#"+bu).remove().empty();var by="";if(bx!=""){by='<div class="pp3diso-obj-bulle">'+bx+"<div>"}H.append('<div id="'+bu+'" class="pp3diso-objet"><img src="'+bE+'" alt="" />'+by+"</div>");a("#"+bu).attr("rel",bE+":"+bv+":"+bt);a3++;a("#"+bu+" img").load(function(){var bM=~~(this.width*a6.zoom);var bL=~~(this.height*a6.zoom);a(this).width(bM).height(bL);if(bx!=""){var bG=a("#"+bu+" .pp3diso-obj-bulle");if(a6.bulle_auto_x){var bH=bG.outerWidth();var bK=~~(((bM-bH)>>1));bG.css({left:bK})}if(a6.bulle_auto_y=="top"){var bI=bG.height();var bJ=-(bI+a6.bulle_obj_deca_y);bG.css({top:bJ})}else{if(a6.bulle_auto_y=="bottom"){var bI=bG.height();var bJ=-(bI+a6.bulle_obj_deca_y);bG.css({bottom:bJ})}}}a3--;if(move_map_waiting){P()}});a("#"+bu).css({"z-index":300000+aS(bA,bC),position:"absolute",left:~~(bD),top:~~(bB),display:"block"})}}function bg(){a("#pp3diso-win-fond").fadeTo(500,0,function(){a("#pp3diso-win-fond").remove().empty()});a("#pp3diso-win").remove().empty();a("#pp3diso-clicks").css("display","block")}this.message=function(bu,bD,bA){if(a("#pp3diso-win").length!=0){return}aT.css("display","none");var bz='<div id="pp3diso-win-fond"></div>';bz+='<div id="pp3diso-win"><div id="pp3diso-close"></div><div class="pp3diso-win-texte">'+bD+"</div>";if(bA!=""){var bC=bA.split("||");bz+='<div id="pp3diso-win-form">';var bw=bC.length;for(var by=0;by<bw;by++){bx=bC[by].split("::");bz+='<a href="#" rel="'+bx[1]+'" class="pp3diso-win-button" id="pp3diso-win-'+by+'">'+bx[0]+"</a>"}bz+="</div>"}bz+="</div>";j.append(bz);a("#pp3diso-win-0").focus();var bB=a("#pp3diso-win");bx=(ae/3);var bt=(bx<<1);var bv=(bx>>1);var bs=-1;a("#pp3diso-win-fond").css({position:"absolute",width:aM,height:aL,left:0,top:0,"z-index":800000,display:"block"}).fadeTo(0,0.4);bB.css({position:"absolute",width:bt,left:bv,top:50,"z-index":800001,display:"none"});bB.slideDown(100);a("#pp3diso-clicks").css("display","none");a("#pp3diso-close").click(function(bE){bE.preventDefault();bE.stopImmediatePropagation();a6.beforeclosewin(0);bB.slideUp("fast",function(){bg();a6.afterclosewin(bu,bs)})});if(bA!=""){var bC=bA.split("||");var bw=bC.length;for(var by=0;by<bw;by++){var bx=bC[by].split("::");a("#pp3diso-win-"+by).click(function(bF){bF.preventDefault();bF.stopImmediatePropagation();var bE=a(this).attr("rel");a6.beforeclosewin(bE);bB.slideUp("fast",function(){bg();a6.afterclosewin(bu,bE)})})}}};this.zoomMap=function(bs){b(bs)};function aO(){a("#pp3diso-clicks").remove().empty();a("#pp3diso-Map").remove().empty();if(a6.mapZonesColors!=""){var bs=a6.mapZonesColors.split(":");var bt=bs.length;for(i=0;i<bt;i++){ar[i].clearRect(0,0,bo[i].width,bo[i].height)}a("pp3Diso-mapZone").remove().empty()}}function b(bt){a("#pp3diso-avatar").clearQueue();A=null;A=[];aU=null;aU=[];a(".pp3Diso_PF").remove().empty();if(bt<a6.zoom_min){bt=a6.zoom_min}if(bt>a6.zoom_max){bt=a6.zoom_max}aO();var bw=a6.zoom;a6.zoom=bt;var bB=bw-bt;var bE=e-((e*bB)|0);var bJ=c-((c*bB)|0);e=bE;c=bJ;v=~~(a6.zoom*100)+"%";a6.tx=R*a6.zoom;a6.ty2=(a6.tx>>1);a6.ty=Q*a6.zoom;a6.ty2=av*a6.zoom;aK=(a6.tx>>1);al=a6.ty2;aM=~~(K*(a6.tx));aL=~~(J*(al<<1)+(a6.ty2));C=(aM>>1);am=((ae-aM)>>1);W=((ad-aL)>>1);if(a6.mapZonesColors!=""){var bz=a6.mapZonesColors.split(":");var bv=bz.length;for(bH=0;bH<bv;bH++){bo[bH].width=aM;bo[bH].height=aL}}if(a6.auto_size){j.css({width:aM,height:aL})}aR(E);if(!a6.mode2d){aa.css("display","block")}aW(E);var bI=[];bI=bi;bi=null;bi=[];for(var bH in bI){if(bI[bH]["id"]!=""){var bC="o_"+bI[bH]["id"];a("#"+bC).remove().empty();X(bI[bH]["x"],bI[bH]["y"],bI[bH]["sprite"],bI[bH]["decx"],bI[bH]["decy"],bI[bH]["titre"],bI[bH]["bulle"],bI[bH]["id"])}}for(var by=1;by<=J;by++){for(var bA=1;bA<=K;bA++){if(ac[by][bA]==2){var bC="b_"+by+"_"+bA;bI=(a("#"+bC).attr("rel")).split(":");a("#"+bC).remove().empty();aY(bA,by,bI[0],bI[1],bI[2])}}}var bs=a("#pp3diso-cursor-img");if(!bs.length==0){var bI=bs.attr("rel").split(":");O=~~(bI[0]*a6.zoom);N=~~(bI[1]*a6.zoom);bs.attr("width",O).attr("height",N)}var bG=a("#pp3diso-avatar-img");if(!(bG.length==0)){if(Z){nbr_x=4}else{nbr_x=1}var bu=~~(100*aE)+"%";var bF=~~((a2*aE*a6.zoom)/aE);var bD=~~((a1*a6.zoom));var bx=a("#pp3diso-avatar-img");a("#pp3diso-avatar").css({width:bF,height:bD});bx.css({position:"absolute",overflow:"hidden",display:"block",left:0,top:0,width:bF*aE,height:bD*nbr_x})}aF=q*a6.zoom;aC=bf*a6.zoom;var bI=a6.speed_avatar;a6.speed_avatar=1;B(bp,bn);a6.speed_avatar=bI;P();a6.onchangezoom(bt)}this.moveMapOn=function(){var bu=["s","n","e","o","se","so","ne","no"];var bt=bu.length;for(var bs=0;bs<bt;bs++){var bv="#pp3diso-fleche-"+bu[bs];if(a(bv).length){a(bv).bind("mouseover",function(){var bw=a(this).attr("id");bw=bw.substr(15);if(!an){an=true;k(bw,a6.speed_by_titleset)}});a(bv).bind("mouseout",function(){o()})}}};function k(bu,bv){if(bl){return}var bs=(a6.ty>>1)*bv;var bt=(a6.tx>>1)*bv;switch(bu){case"n":c+=bs;break;case"ne":c-=bs;e-=bt;break;case"e":e-=bt;break;case"se":e-=bt;c+=bs;break;case"s":c-=bs;break;case"so":c+=bs;e+=bt;break;case"o":e+=bt;break;case"no":c-=bs;e+=bt;break}if(e<-(aM-ae)){e=-(aM-ae)}if(e>0){e=0}if(c<-(aL-ad)){c=-(aL-ad)}if(c>0){c=0}P();if(an){clearInterval(ah);ah=setInterval(function(){if(an&&!bl){k(bu,bv)}},a6.speed_map_while)}}this.moveMapOne=function(bs,bt){k(bs,bt)};this.moveMapWhile=function(bs,bt){an=true;k(bs,bt)};function o(){an=false;clearInterval(ah)}this.moveMapStop=function(){o()};this.tipShow=function(bv,bt,bs,bu){aT.css({display:"none"});aT.html(bv);if(bt==0){bs=h(S,U)+bb+bs;bu=g(S,U)+ba+bu}else{if(bt==1){if(bs<0){bs+=ae;bs-=aT.outerWidth()}if(bu<0){bu+=ad;bu-=aT.outerHeight()}bs-=e;bu-=c}}aT.css({top:bu,left:bs,display:"none"});aT.stop(true,true).fadeIn("normal");bh=true};this.tipHide=function(){aT.stop(true,true).fadeOut("normal",function(){bh=false})};this.toggleZone=function(bt,bu){if(bu==""){bu="normal"}bt--;var bs=a("#pp3Diso-mapZone-canvas-"+bt);if(bs.css("display")=="none"){bs.fadeIn(bu)}else{bs.fadeOut(bu)}};this.showZone=function(bs,bt){if(bt==""){bt="normal"}bs--;a("#pp3Diso-mapZone-canvas-"+bs).fadeIn(bt)};this.hideZone=function(bs,bt){if(bt==""){bt="normal"}bs--;a("#pp3Diso-mapZone-canvas-"+bs).fadeOut(bt)};return this}})(jQuery);var mapLength,mapRowLength,gMinx,gMaxx,gMiny,gMaxy;function astar(j,f,k,g,b,d,r,o,q,m){var h=[];var l=[];var a=[];if(o==false){gMaxx=b.length}else{gMaxx=o}if(r==false){gMinx=0}else{gMinx=r}if(m==false){gMaxy=b[0].length}else{gMaxy=m}if(q==false){gMiny=0}else{gMiny=q}mapLength=gMaxx;mapRowLength=gMaxy;var e=new Node(k,g,b,null,null);var p=new Node(j,f,b,null,e);addNodeToList(p,h);var c;while(!isListEmpty(h)){c=returnNodeWithLowestFScore(h);addNodeToList(c,l);removeNodeFromList(c,h);if(areNodesEqual(c,e)){pathTo(c,a);a.reverse();return a}c.makeChildNodes(b,d,e);cullUnwantedNodes(c.childNodes,h);cullUnwantedNodes(c.childNodes,l);removeMatchingNodes(c.childNodes,h);removeMatchingNodes(c.childNodes,l);addListToList(c.childNodes,h)}return null}function pathTo(b,a){a.push(new NodeCoordinate(b.row,b.col));if(b.parentNode==null){return}pathTo(b.parentNode,a)}function addListToList(b,a){for(x in b){a.push(b[x])}}function removeMatchingNodes(d,f){var c=d.length;var e=f.length;for(var b=0;b<c;b++){for(var a=0;a<e;a++){if(f[a].row==d[b].row&&f[a].col==d[b].col){f.splice(a,1);e=f.length}}}}function cullUnwantedNodes(d,a){var e=a.length;var f=d.length;for(var c=0;c<e;c++){for(var b=0;b<f;b++){if(d[b].row==a[c].row&&d[b].col==a[c].col){if(d[b].f>=a[c].f){d.splice(b,1);f=d.length}}}}}function areNodesEqual(b,a){if(b.row==a.row&&b.col==a.col){return true}else{return false}}function returnNodeWithLowestFScore(b){var a=b[0];for(x in b){if(b[x].f<a.f){a=b[x]}}return a}function isListEmpty(a){return(a.length<1)?true:false}function removeNodeFromList(b,c){var d=c.length;for(var a=0;a<d;a++){if(b.row==c[a].row&&b.col==c[a].col){c.splice(a,1);break}}}function addNodeToList(a,b){b.push(a)}function returnHScore(b,d){var c=b.row-d.row;if(c<0){c=-c}var a=b.col-d.col;if(a<0){a=-a}if(a>c){return(c*14)+10*(a-c)}else{return(a*14)+10*(c-a)}}function NodeCoordinate(b,a){this.row=b;this.col=a}function Node(d,b,c,a,e){this.row=d;this.col=b;if(d<=gMiny){this.northAmbit=gMiny}else{this.northAmbit=d-1}if(d>=gMaxy-1){this.southAmbit=gMaxy-1}else{this.southAmbit=d+1}if(b<=gMinx){this.westAmbit=gMinx}else{this.westAmbit=b-1}if(b>=gMaxx-1){this.eastAmbit=gMaxx-1}else{this.eastAmbit=b+1}this.parentNode=a;this.childNodes=[];if(a!=null){if(d==a.row||b==a.col){this.g=a.g+10}else{this.g=a.g+14}this.h=returnHScore(this,e)}else{this.g=0;if(c[d][b]=="s"){this.h=returnHScore(this,e)}else{this.h=0}}this.f=this.g+this.h;this.makeChildNodes=function(k,f,l){for(var h=this.northAmbit;h<=this.southAmbit;h++){for(var g=this.westAmbit;g<=this.eastAmbit;g++){if(h!=this.row||g!=this.col){if(k[h][g]!="0"){if(f){this.childNodes.push(new Node(h,g,k,this,l))}else{if(h==this.row||g==this.col){this.childNodes.push(new Node(h,g,k,this,l))}}}}}}}};